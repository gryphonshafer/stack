#!/usr/bin/env bash
_results=`docker pull gitlab/gitlab-ce:latest`
if [[ $( echo $_results | grep 'Image is up to date' | wc -l ) == 0 ]]
then
    docker stop gitlab
    docker rm gitlab
    docker run \
        --detach \
        --hostname {{ inventory_hostname }}.{{ domain }} \
        --publish 5880:80 \
        --publish 6722:22 \
        --name gitlab \
        --restart unless-stopped \
        --volume /opt/gitlab/config:/etc/gitlab \
        --volume /opt/gitlab/logs:/var/log/gitlab \
        --volume /opt/gitlab/data:/var/opt/gitlab \
        gitlab/gitlab-ce:latest
fi
