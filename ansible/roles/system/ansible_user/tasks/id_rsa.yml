---
- stat:
    path: "{{ local_dir }}/ansible.id_rsa"
  register: id_rsa
  when: local_dir is defined

- name: copy in ansible user id_rsa
  copy:
    src: "{{ local_dir }}/ansible.id_rsa"
    dest: "/home/ansible/.ssh/id_rsa"
    owner: ansible
    group: ansible
    mode: "0600"
  when: id_rsa.stat.exists

- stat:
    path: "{{ local_dir }}/ansible.id_rsa.pub"
  register: authorized_keys
  when: local_dir is defined

- name: copy in ansible user authorized_keys
  copy:
    src: "{{ local_dir }}/ansible.id_rsa.pub"
    dest: "/home/ansible/.ssh/authorized_keys"
    owner: ansible
    group: ansible
    mode: "0644"
  when: authorized_keys.stat.exists

- name: save copy of ansible user ssh keys
  copy:
    src: "/home/ansible/.ssh/id_rsa"
    dest: "{{ local_dir }}/ansible.id_rsa"
    remote_src: true
  when: local_dir is defined

- name: save copy of ansible user ssh keys
  copy:
    src: "/home/ansible/.ssh/authorized_keys"
    dest: "{{ local_dir }}/ansible.id_rsa.pub"
    remote_src: true
  when: local_dir is defined
